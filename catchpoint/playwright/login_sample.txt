import { test, expect } from '@playwright/test';

test('Login and handle cookies on example.lab', async ({ page }) => {
  // Get credentials securely from Catchpoint Library
  const username = getSecret("example_user", "username");
  const password = getSecret("example_user", "password");

  // Step 1: Navigate to login page
  await page.goto('https://www.example.lab', { waitUntil: 'domcontentloaded' });

  // Step 2: Handle "Accept All Cookies" popup if it appears
  const cookieBtn = page.locator('button:has-text("Accept All Cookies")');
  if (await cookieBtn.count() > 0) {
    await cookieBtn.click();
  }

  // Step 3: Enter credentials
  await page.fill('#username', username);
  await page.fill('#password', password);

  // Step 4: Click login button
  await page.click('#loginButton');

  // Step 5: Wait for an element that indicates successful login
  await expect(page.locator('#dashboard')).toBeVisible({ timeout: 15000 });

  // Optional: Capture screenshot for debugging
  await page.screenshot({ path: 'after_login.png' });
});
